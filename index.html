<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quran Pages</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #FFF;
            height: 100vh;
            width: 100vw;
        }

        #quran-page-image {
            width: 100%;
            height: 100vh;
            object-fit: contain;
            background-color: #FFF;
            display: block;
            margin: auto;
        }

        #cache-maker {
            display: none;
        }
    </style>
</head>

<body>
    <img src="" alt="No page" id="quran-page-image" />
    <img id="cache-maker">
    <script>
        const LAST_PAGE = 604;
        const BASE_URL = "img/__index__.png?raw=true";
        const img = document.getElementById('quran-page-image');
        const cache = document.getElementById('cache-maker');
        let pageNumber = parseInt(document.location.href.split('#')[1]);
        let filter = localStorage.getItem('filterMode') || 'invert(0)';
        document.body.style.filter = filter;  
        if (!pageNumber || isNaN(pageNumber)) {
            pageNumber = parseInt(localStorage.getItem('lastViewedQuranPage')) || 1;
            document.location.href = '#' + pageNumber;
            location.reload();
        }
        img.onload = function () {
            if (pageNumber < LAST_PAGE) {
                cache.src = BASE_URL.replace('__index__', (pageNumber + 1).toString().padStart(3, '0'));
            }
        };
        img.src = (pageNumber >= 0 && pageNumber <= LAST_PAGE)
            ? BASE_URL.replace('__index__', pageNumber.toString().padStart(3, '0'))
            : '';
        
        window.addEventListener('keydown', function (e) {
            e.preventDefault();
            console.log(e.key);
            if (e.key === 'ArrowRight' || e.key === ' ' || e.key === 'PageDown') {
                if (pageNumber < LAST_PAGE) {
                    document.location.href = '#' + (pageNumber + 1);
                    location.reload();
                }
                localStorage.setItem('lastViewedQuranPage', pageNumber + 1);
            } else if (e.key === 'ArrowLeft' || e.key === 'Backspace' || e.key === 'PageUp') {
                if (pageNumber > 1) {
                    document.location.href = '#' + (pageNumber - 1);
                    location.reload();
                }
                localStorage.setItem('lastViewedQuranPage', pageNumber - 1);
            } else if (e.key === 'b') {
                if (document.body.style.filter === 'invert(1)') {
                    document.body.style.filter = 'invert(0)';
                } else {
                    document.body.style.filter = 'invert(1)';
                }
                localStorage.setItem('filterMode', document.body.style.filter);
            }
        });
    </script>
</body>

</html>
